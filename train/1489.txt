fit a HMM and calculate optimal hidden states sequences